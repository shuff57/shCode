<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Debug Exercise with Resizable Live Editor</title>

<style>
  :root{
    --bg: #121212;
    --card: #1e1e1e;
    --border: #333;
    --muted: #2a2a2a;
    --text: #e0e0e0;
    --brand: #5baafd;
  }

  /* Base */
  body {
    background-color: var(--bg);
    color: var(--text);
    font-family: Arial, sans-serif;
    line-height: 1.6;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  code {
    background-color: #2d2d2d;
    color: #d65093;
    padding: 3px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-weight: bold;
  }

  /* Requirements styling */
  .requirement {
    background-color: var(--card);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--border);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  .requirement h3 {
    margin-top: 0;
    color: var(--brand);
  }

  /* Collapsible editor card */
  details.editor-card {
    background-color: #333333;               /* header background */
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  /* Summary (header) with custom arrow */
  details.editor-card > summary {
    cursor: pointer;
    font-weight: bold;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    color: var(--text);
    list-style: none;           /* hide default marker */
    transition: background-color .2s ease, color .2s ease;
  }
  details.editor-card > summary::-webkit-details-marker { display: none; }

  /* Custom arrow */
  details.editor-card > summary::before {
    content: '';
    display: inline-block;
    width: 0; height: 0;
    border-left: 6px solid var(--text);
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    transition: transform .15s ease-in-out, border-left-color .2s ease;
  }
  /* Rotate + colorize on open */
  details.editor-card[open] > summary::before {
    transform: rotate(90deg);
    border-left-color: var(--brand);
  }
  /* Hover state */
  details.editor-card > summary:hover {
    color: var(--brand);
    background-color: var(--muted);
  }
  details.editor-card > summary:hover::before {
    border-left-color: var(--brand);
  }

  /* Card body */
  .editor-body {
    background: var(--card);
    border-top: 1px solid #444;
    padding: 16px;
  }

  /* Resizable split container */
  .editor-preview-container {
    position: relative; /* for overlay */
    display: flex;
    align-items: stretch;
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    height: 420px;
    overflow: hidden;
  }

  .pane {
    flex: 1 1 50%;
    min-width: 220px;
    height: 100%;
    position: relative;
    display: flex;
  }

  #editor { width: 100%; height: 100%; }
  #preview {
    width: 100%;
    height: 100%;
    border: none;
    background: white;
  }

  /* Draggable divider */
  .divider {
    width: 8px;
    background: var(--muted);
    cursor: col-resize;
    user-select: none;
    touch-action: none;
    z-index: 6; /* above iframe */
  }
  .divider:focus-visible {
    outline: 2px solid var(--brand);
    outline-offset: -2px;
  }

  /* Overlay prevents iframe from stealing pointer events while dragging */
  .drag-overlay {
    position: absolute;
    inset: 0;
    display: none;      /* toggled during drag */
    cursor: col-resize;
    z-index: 5;
    background: transparent;
  }
</style>
</head>

<body>

<!-- Collapsible “card” with editor + live preview + resizer -->
<details class="editor-card" open>
  <summary>Starter Code & Live Preview</summary>
  <div class="editor-body">
    <div class="editor-preview-container" id="split">
      <div class="pane" id="editorPane">
        <div id="editor"></div>
      </div>
      <div class="divider" id="divider" tabindex="0" aria-label="Resize editor and preview"></div>
      <div class="pane" id="previewPane">
        <iframe id="preview" title="Live Preview"></iframe>
      </div>
      <div class="drag-overlay" id="dragOverlay" aria-hidden="true"></div>
    </div>
  </div>
</details>

<h2>Requirements to Pass</h2>

<div class="requirement">
  <h3>Requirement 1</h3>
  <p>You should have exactly one <code>h1</code> element on the page.</p>
</div>
<div class="requirement">
  <h3>Requirement 2</h3>
  <p>You should not remove the <code>&lt;h1&gt;Hello from Camperbot!&lt;/h1&gt;</code> element from the page.</p>
</div>
<div class="requirement">
  <h3>Requirement 3</h3>
  <p>You should have exactly one <code>h2</code> element on the page.</p>
</div>
<div class="requirement">
  <h3>Requirement 4</h3>
  <p>You should have an <code>h2</code> element with the text "About".</p>
</div>
<div class="requirement">
  <h3>Requirement 5</h3>
  <p>You should have a paragraph element with the text "My name is Camperbot and I love learning new things."</p>
</div>
<div class="requirement">
  <h3>Requirement 6</h3>
  <p>You should have a paragraph element with the text "I enjoy solving puzzles."</p>
</div>
<div class="requirement">
  <h3>Requirement 7</h3>
  <p>You should have exactly two paragraph elements on the page.</p>
</div>
<div class="requirement">
  <h3>Requirement 8</h3>
  <p>You should have exactly one <code>h3</code> element on the page.</p>
</div>
<div class="requirement">
  <h3>Requirement 9</h3>
  <p>You should have an <code>h3</code> element with the text "Background and Interests".</p>
</div>
<div class="requirement">
  <h3>Requirement 10</h3>
  <p>You should have exactly five total elements on the page.</p>
</div>

<!-- Monaco Editor loader -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
<script>
  // Load Monaco from CDN
  require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    const starterCode = `<h1>Hello from Camperbot!</h1>

<heading2>About</heading2>

<pp>My name is Camperbot and I love learning new things.</pp>

<h3>Background and Interests<h3/>
<pp>I enjoy solving puzzles.</pp>`;

    const editorInstance = monaco.editor.create(document.getElementById('editor'), {
      value: starterCode,
      language: 'html',
      theme: 'vs-dark',
      fontSize: 14,
      automaticLayout: true
    });

    // Expose for layout calls
    window.editor = editorInstance;

    const previewFrame = document.getElementById('preview');

    function updatePreview() {
      const htmlContent = editorInstance.getValue();
      const doc = previewFrame.contentDocument || previewFrame.contentWindow.document;
      doc.open();
      doc.write(htmlContent);
      doc.close();
    }

    // Initial render + live update
    editorInstance.onDidChangeModelContent(updatePreview);
    updatePreview();

    // ----- Resizable split logic (hardened) -----
    const split        = document.getElementById('split');
    const divider      = document.getElementById('divider');
    const left         = document.getElementById('editorPane');
    const right        = document.getElementById('previewPane');
    const overlay      = document.getElementById('dragOverlay');
    let dragging = false;
    let rect = null;
    let rafId = null;

    function relayoutEditor() {
      if (rafId) return;
      rafId = requestAnimationFrame(() => {
        if (window.editor && typeof window.editor.layout === 'function') {
          window.editor.layout();
        }
        rafId = null;
      });
    }

    function setPositions(clientX) {
      if (!rect) rect = split.getBoundingClientRect();
      const min = 220;
      const max = rect.width - 220;
      let x = clientX - rect.left;
      x = Math.max(min, Math.min(max, x));
      const leftPct = (x / rect.width) * 100;
      left.style.flex  = `0 0 ${leftPct}%`;
      right.style.flex = `0 0 ${100 - leftPct}%`;
      relayoutEditor();
    }

    function onMove(e) {
      if (!dragging) return;
      setPositions(e.clientX);
      e.preventDefault();
    }

    function stopDrag() {
      if (!dragging) return;
      dragging = false;
      overlay.style.display = 'none';
      document.body.style.userSelect = '';
      window.removeEventListener('pointermove', onMove, false);
      window.removeEventListener('pointerup', onUp, false);
      window.removeEventListener('pointercancel', onCancel, false);
      window.removeEventListener('blur', onWindowBlur, false);
      document.removeEventListener('visibilitychange', onVisChange, false);
    }

    function onUp(e) {
      try { divider.releasePointerCapture(e.pointerId); } catch {}
      stopDrag();
    }
    function onCancel() { stopDrag(); }
    function onWindowBlur() { stopDrag(); }
    function onVisChange() { if (document.hidden) stopDrag(); }

    divider.addEventListener('pointerdown', (e) => {
      dragging = true;
      rect = split.getBoundingClientRect();
      overlay.style.display = 'block';            // block iframe events
      document.body.style.userSelect = 'none';
      try { divider.setPointerCapture(e.pointerId); } catch {}
      // Listen on window so we keep getting events even if cursor leaves the container
      window.addEventListener('pointermove', onMove, false);
      window.addEventListener('pointerup', onUp, false);
      window.addEventListener('pointercancel', onCancel, false);
      window.addEventListener('blur', onWindowBlur, false);
      document.addEventListener('visibilitychange', onVisChange, false);
      e.preventDefault();
    }, false);

    // Keyboard resizing (accessible)
    divider.addEventListener('keydown', (e) => {
      const step = e.shiftKey ? 40 : 10;
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        rect = split.getBoundingClientRect();
        const currentLeft = left.getBoundingClientRect().width || rect.width / 2;
        const next = currentLeft + (e.key === 'ArrowRight' ? step : -step);
        setPositions(rect.left + next);
        e.preventDefault();
      }
    }, false);

    // Keep Monaco crisp on window resize
    window.addEventListener('resize', () => relayoutEditor(), false);
  });
</script>

</body>
</html>
